########################################################################
# This is the configuration file of GridPilot
#
# Sections:
#
# - GridPilot : contains general parameters
# - File transfer systems : information about the file transfer systems
# - - For each system defined in File transfer systems, a section is required
# - Databases : information about the database connection
# - - For each system defined in Databases, a section is required
# - Computing Systems : contains the list of computing systems
# - - For each system defined in section Computing Systems, a section is required
#
# All tags are case insensitive, and a text after a # is a comment (but \# is allowed)
#
# Main author:
#
# - Frederik ORELLANA (frederik.orellana@cern.ch)
#
# Contributors:
#
# - Cyril TOPFEL (cyril.topfel@lhep.unibe.ch)
# - Marco NIINIMAKI (marko.niinimaki@cern.ch)
# - Luc GOOSSENS (luc.goossens@cern.ch)
# - Vandy BERTEN (vandy.berten@cern.ch)
#
########################################################################

[GridPilot]
# This name is only used for field in jobDefinition tables ONLY if
# no name can be obtained from grid certificate of OS
user = firelord
# Path to images, certificates, about
resources = /resources/		
# Debug level ; 0 : all debugs are disabled, 3 : maximum.
# Notice that having a high debug level can have a big impact on performance
debug = 0

# Attributes always displayed when creating job definitions
job attributes = number name

# Inital panels (tabs) displayed
initial panels = transformation dataset

# File to store the history of the file browser
browser history file = ~/gridpilot_history.txt

# Web proxy settings
proxy server = 
proxy port =

# List of preferred files servers when down/uploading
preferred file servers =

# number of seconds before timeout of proxy when proxy will be renewed
proxy time left limit = 43200 # 12h
proxy time valid = 129600 # 36 h
key file = ~/.globus/userkey.pem
certificate file = ~/.globus/usercert.pem
grid proxy directory = ~/.globus
key password = 
# A comma separated list of fully qualified file or directory paths.
# If this is left blank, the default certificates shipped with GridPilot will be used
ca certificates = # ~/.globus/certificates, /etc/grid-security/certificates

# submissions
maximum simultaneous submissions = 1
time between submissions = 5000 # in ms
randomized submission = no

# transfers
maximum simultaneous transfers = 10
time between transfers = 500 # in ms
randomized transfers = no
# default URL when replicating
gridftp home url = ~

# updates
maximum simultaneous checking = 3
time between checks = 500 # in ms

# validation
delay before validation = 3000 # in ms
maximum simultaneous validating = 3

# timeouts (in seconds)
default timeout = 60
submit timeout = 60
updateStatus timeout = 60
killJob timeout = 60
clearOutputMapping timeout = 60
exit timeout = 60
getFullStatus timeout = 60
getCurrentOutputs timeout =  60
db timeout = 60000

#####################################################################
[File transfer systems]
#
# File transfer systems used for replicating files.
#

# These are the supported systems. The names must match the protol names.
# NOTICE: always put subsystems before high-level systems, that is,
# always put srm last.
Systems = gsiftp
# These ports must be inbound open in your firewall (comma-separated list)
globus tcp port range = 9001,9010
# Timeouts in seconds
copy retries = 0
copy retry timeout = 120

[gsiftp]
class = gridpilot.ftplugins.gsiftp.GSIFTPFileTransfer

#####################################################################
[Databases]
#
# Databases used for storing runtime and transformation
# informations as well as file and job information.
#

# NOTICE: use ONLY ONE local database at a time
Systems = My_DB_local

#--------------------------------------------------------------------
[My_DB_local]
#
# Minimal dataset/job/file catalog for personal production/analysis.
#
class = gridpilot.dbplugins.hsqldb.HSQLDBDatabase
driver = org.hsqldb.jdbcDriver
database = hsql://localhost/~/GridPilot/My_DB
user = sa
password = ""

parameters = driver database user password

default dataset fields = name runNumber identifier
hidden dataset fields = metaData
default jobDefinition fields = name status
default file fields = dsname lfname pfname guid
file identifier = guid
file name = lfname
file dataset reference = name dsname

dataset field names = identifier,                                           name,                 transformationName, transformationVersion, metaData,         totalFiles,  totalEvents, created,  lastModified, inputDataset,     inputDB,          outputLocation
dataset field types = INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, LONGVARCHAR NOT NULL, LONGVARCHAR NULL,   LONGVARCHAR NULL,      LONGVARCHAR NULL, BIGINT NULL, BIGINT NULL, DATETIME, DATETIME,     LONGVARCHAR NULL, LONGVARCHAR NULL, LONGVARCHAR NULL

jobDefinition field names = identifier,                                           datasetName, name,        GUID,        number, eventMin, eventMax, nEvents,  outputFileKilobytes, cpuSeconds, status,  userInfo,    inputFileNames, transPars,   outFileMapping, md5sum,      stdoutDest,  stderrDest,  created,  lastModified, jobID,        outTmp,       errTmp,       validationResult, computingSystem
jobDefinition field types = INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, INT,    INT,      INT,      INT,      INT NULL,            INT NULL,   VARCHAR, LONGVARCHAR, LONGVARCHAR,    LONGVARCHAR, LONGVARCHAR,    LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, DATETIME, DATETIME,     VARCHAR NULL, VARCHAR NULL, VARCHAR NULL, LONGVARCHAR NULL, VARCHAR NULL

transformation field names = identifier, name, version, runtimeEnvironmentName, arguments, outputFiles, script, comment, created, lastModified, inputFiles
transformation field types = INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, LONGVARCHAR, VARCHAR, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, DATETIME, DATETIME, LONGVARCHAR

runtimeEnvironment field names = identifier, name, computingSystem, certificate, url, initLines, created, lastModified
runtimeEnvironment field types = INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, DATETIME, DATETIME

# This is to have an explicit file catalog

file field names = lfname, pfname, filetype, md5sum, fsize, lastmodified, archival, dsname, guid

t_lfn field names = lfname, guid
t_lfn field types = LONGVARCHAR, VARCHAR NULL

t_pfn field names = pfname, guid, filetype
t_pfn field types = LONGVARCHAR, VARCHAR NULL, LONGVARCHAR NULL

t_meta field names = guid, md5sum, fsize, lastmodified, archival, dsname
t_meta field types = VARCHAR, LONGVARCHAR NULL, LONGVARCHAR NULL, LONGVARCHAR NULL, LONGVARCHAR NULL, LONGVARCHAR, VARCHAR

#####################################################################
[Computing systems]
#
# Backends for executing computing jobs.
#

systems = FORK NG # SSH

#--------------------------------------------------------------------
[FORK]
#
# Run jobs on the local computer.
#

## Sub-section for GridPilot
host = localhost
user =
password =
class = gridpilot.csplugins.fork.ForkComputingSystem
working directory = ~/GridPilot/jobs
# number of jobs whose status is checked by each thread (see maximum simultaneous checking)
max jobs by update = 10

## Sub-Section for this plug-in
shell = /bin/bash
# Directory with runtime setup scripts
runtime directory = ~/GridPilot/runtimeEnvironments
# Where to create a sample test transformation. If not defined, none is created.
transformation directory = ~/GridPilot/transformations
# In which DBs to write the runtime environment records. If not specified,
# runtime environment records must be defined by hand.
runtime databases = My_DB_local My_DB_Geneva

## Sub-section for picking up jobs from external database
# Certificate used by submitters to encrypt their
# proxy certificate+key to the GridPilot picking up
# the job. Only needed to pick up jobs.
# NOTICE: the certificate should NOT include a key!
#public certificate = C:\Documents and Settings\Frederik Orellana\.globus\usercert.pem
# Remote DB to announce runtime environments and
# from where to pick up jobs. 
# Only needed to pick up jobs.
#remote database = My_DB_Geneva

#--------------------------------------------------------------------
[SSH]
#
# Run jobs on remote computer.
#

## Sub-section for GridPilot
# Notice: if you use lxplus.cern.ch you disconnect, reconnect and find you jobs again,
# since you will most likely be on a different machine.
host = lxplus070.cern.ch
user = 
password =
class = gridpilot.csplugins.fork.ForkComputingSystem
working directory = ~/GridPilot/jobs
max jobs by update = 1

## Sub-Section for this plug-in
shell = /bin/bash
# Directory with runtime setup scripts
runtime directory = ~/GridPilot/runtimeEnvironments
# Where to create a sample test transformation. If not defined, none is created.
transformation directory = ~/GridPilot/transformations
# In which DB to write the runtime environment records. If not specified,
# runtime environment records must be defined by hand.
runtime database = My_DB_Geneva

# When using remote input files or output destination (castor://, ftp://, gsiftp://, ...)
# a command for getting/putting the files (e.g. ngcopy gsiftp://server/dir/file.root file.root)
# and optionally a runtime environment providing this command should be specified.
# Notice: to have file copied from the local machine to the ssh host, specify
# input files as file://. If they are given as /dir/file or C:\dir\file, they
# are assumed to be on the server already.
remote copy command = ngcopy
required runtime environment = ARC

#--------------------------------------------------------------------
[NG]
#
# Submit jobs to NorduGrid. All interaction is done in pure java.
#

## Sub-section for GridPilot
class = gridpilot.csplugins.ng.NGComputingSystem
max jobs by update = 1
working directory = GridPilot/jobs

## Sub-Section for this plug-in
# Where to write the runtime records
runtime databases = My_DB_local My_DB_Geneva
use information system = yes
# The GIIS information servers to query for clusters
GIISes = ldap://odin.switch.ch:2135/Mds-Vo-name=Switzerland,o=grid # index4.nordugrid.org
# explicitly choose clusters. If this is set, GIIS servers will not be queried.
clusters = grid01.unige.ch # interop.dcgc.dk # morpheus.dcgc.dk # grid00.unige.ch # lheppc10.unibe.ch hypatia.uio.no hagrid.it.uu.se benedict.grid.aau.dk nordugrid.unibe.ch nordugrid-lcg.projects.cscs.ch
# Required CPU time in minutes.
cpu time = 1800
# Number of seconds before timeout of proxy when proxy will be renewed.
timeleft limit = 86400
shell = /bin/sh

