########################################################################
# This is the configuration file of GridPilot
#
# Sections:
#
# - GridPilot : contains general parameters
# - Databases : information about the database connection
# - - For each system defined in Databases, a section is required
# - Computing Systems : contains the list off every plug-ins (or computing systems)
# - - For each system defined in section Computing Systems, a section is required
#
# All tags are case insensitive, and a text after a # is a comment (but \# is allowed)
#
# In each plug-in section, two parameters are required :
# - ComputingSystem class : name of the class which implements the ComputingSystem interface
# - Database class : name of the class which implements the Database interface
# - working path : directory where scripts and ouptut are written
#
# Authors :
#
# - Vandy BERTEN (vandy.berten@cern.ch)
# - Luc GOOSSENS (luc.goossens@cern.ch)
# - Marco NIINIMAKI (marko.niinimaki@cern.ch)
# - Frederik ORELLANA (frederik.orellana@cern.ch)
#
########################################################################

[GridPilot]
user = firelord		# this name is only used for field in jobDefinition tables
resources = /resources/		# path of icons, help, ...
debug = 3			# debug level ; 0 : all debugs are disabled, 3 : maximum

# Attributes always displayed when creating job definitions
job parameters = number name

# inital panels (tabs) displayed
initial panels = transformation dataset

# number of seconds before timeout of proxy when proxy will be renewed
proxy time left limit = 43200 # 12h
proxy time valid = 129600 # 36 h
key file = ~/.globus/userkey.pem
certificate file = ~/.globus/usercert.pem
key password = 
# A comma separated list of fully qualified file or directory paths.
# If this is left blank, the default certificates shipped with GridPilot will be used
ca certificates = # ~/.globus/certificates, /etc/grid-security/certificates

# submission
maximum simultaneous submission = 10
time between submissions = 500 # in ms

# updates
maximum simultaneous checking = 10
time between checks = 500 # in ms

# validation
delay before validation = 100 # in ms
maximum simultaneous validating = 10

# timeouts : in seconds
default timeout = 60
submit timeout = 60
updateStatus timeout = 60
killJob timeout = 60
clearOutputMapping timeout = 60
exit timeout = 60
getFullStatus timeout = 60
getCurrentOutputs timeout =  60
db timeout = 60000

randomized submission = no

[Databases]
Systems = HSQLDB # MySQL@Geneva ProdDB@CERN # AMI@Grenoble
Show all transformations = true

[HSQLDB]
class = gridpilot.dbplugins.hsqldb.HSQLDBDatabase
driver = org.hsqldb.jdbcDriver
#database = file:/tmp/AtlasDB
database = hsql://localhost/tmp/CTB-2006-1
user = sa
password = ""

parameters = driver database user password

default dataset fields = name runNumber identifier
hidden dataset fields = projectName physicsWorkingGroup physicsShort detectorLayout status principalSite softwareRelease physicsPackage externalPackages outputFormat percentageValidatedFiles percentageFailedFiles totalFiles totalDataSize averageEventSize totalEvents averageCPUTime totalCPUTime requestedBy comment created lastModified transValues beam_energy mag_field beam_polarity beam_particle magneticField_Type ID_magneticField MBPL_magneticField MBPS_magneticField eta z theta Pix_StatusWord SCT_StatusWord TRT_StatusWord LAr_StatusWord Tile_StatusWord TileEB_StatusWord MDT_StatusWord TGC_StatusWord RPC_StatusWord CSC_StatusWord BEE_StatusWord Pix_xBeamPosition SCT_xBeamPosition TRT_xBeamPosition TRT_yBeamPosition TRT_zBeamPosition LArTile_xBeamPosition Muon_xBeamPosition MuonBee_xBeamPosition
default jobDefinition fields = name status

# CTB simulation, digitization and reconstruction

dataset field names = identifier,                                           name,                 runNumber,    transformationName, transformationVersion, projectName,      physicsWorkingGroup, physicsShort,     detectorLayout,   status,       principalSite,    softwareRelease, physicsPackage, externalPackages, outputFormat, percentageValidatedFiles, percentageFailedFiles, totalFiles,  totalDataSize, averageEventSize, totalEvents, averageCPUTime, totalCPUTime, requestedBy,      comment,          created,  lastModified, beamEnergy,  mag_field,    beam_polarity, beamParticle, magneticField_Type, ID_magneticField, MBPL_magneticField, MBPS_magneticField, eta,        z,          theta,      Pix_StatusWord, SCT_StatusWord, TRT_StatusWord, LAr_StatusWord, Tile_StatusWord, TileEB_StatusWord, MDT_StatusWord, TGC_StatusWord, RPC_StatusWord, CSC_StatusWord, BEE_StatusWord, Pix_xBeamPosition, SCT_xBeamPosition, TRT_xBeamPosition, TRT_yBeamPosition, TRT_zBeamPosition, LArTile_xBeamPosition, Muon_xBeamPosition, MuonBee_xBeamPosition, dataType,     inputDataset,     inputDB,          outputLocation
dataset field types = INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, LONGVARCHAR NOT NULL, INT NOT NULL, LONGVARCHAR NULL,   LONGVARCHAR NULL,      LONGVARCHAR NULL, LONGVARCHAR NULL,    LONGVARCHAR NULL, LONGVARCHAR NULL, VARCHAR NULL, LONGVARCHAR NULL, VARCHAR NULL,    VARCHAR NULL,   LONGVARCHAR NULL, VARCHAR NULL, FLOAT NULL,               FLOAT NULL,            BIGINT NULL, FLOAT NULL,    FLOAT NULL,       BIGINT NULL, FLOAT NULL,     BIGINT NULL,  LONGVARCHAR NULL, LONGVARCHAR NULL, DATETIME, DATETIME,     FLOAT NULL,  VARCHAR NULL, TINYINT NULL,  VARCHAR NULL, VARCHAR NULL,       FLOAT NULL,       FLOAT NULL,         FLOAT NULL,         FLOAT NULL, FLOAT NULL, FLOAT NULL, TINYINT NULL,   TINYINT NULL,   TINYINT NULL,   TINYINT NULL,   TINYINT NULL,    TINYINT NULL,      TINYINT NULL,   TINYINT NULL,   TINYINT NULL,   TINYINT NULL,   TINYINT NULL,   FLOAT NULL,        FLOAT NULL,        FLOAT NULL,        FLOAT NULL,        FLOAT NULL,        FLOAT NULL,            FLOAT NULL,         FLOAT NULL,            VARCHAR NULL, LONGVARCHAR NULL, LONGVARCHAR NULL, LONGVARCHAR NULL

jobDefinition field names = identifier,                                           datasetName, name,        GUID,        number, eventMin, eventMax, nEvents,  outputFileSize, CPU,      status,  userInfo,    inputFileNames, transPars,   outFileMapping, md5sum,      stdoutDest,  stderrDest,  productionSite, hostMachine, storageType,  created,  lastModified, jobID,        outTmp,       errTmp,       validationResult, computingSystem
jobDefinition field types = INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, INT,    INT,      INT,      INT,      INT NULL,       INT NULL, VARCHAR, LONGVARCHAR, LONGVARCHAR,    LONGVARCHAR, LONGVARCHAR,    LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, VARCHAR,        VARCHAR,     VARCHAR NULL, DATETIME, DATETIME,     VARCHAR NULL, VARCHAR NULL, VARCHAR NULL, LONGVARCHAR NULL, VARCHAR NULL

transformation field names = identifier, name, version, runtimeEnvironmentName, arguments, outputFiles, script, comment, created, lastModified, inputFiles
transformation field types = INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, LONGVARCHAR, VARCHAR, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, DATETIME, DATETIME, LONGVARCHAR

runtimeEnvironment field names = identifier, name, computingSystem, certificate, url, initLines, created, lastModified
runtimeEnvironment field types = INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, LONGVARCHAR, DATETIME, DATETIME

[MySQL@Geneva]
class = gridpilot.dbplugins.mysql.MySQLDatabase
driver = org.gjt.mm.mysql.Driver
database = jdbc:mysql://grid01.unige.ch:3306/CTB-2006-1
user = root
password = 

parameters = driver database user password

default dataset fields = name runNumber
hidden dataset fields = projectName physicsWorkingGroup physicsShort detectorLayout status principalSite softwareRelease physicsPackage externalPackages outputFormat percentageValidatedFiles percentageFailedFiles totalFiles totalDataSize averageEventSize totalEvents averageCPUTime totalCPUTime requestedBy comment created lastModified beam_energy mag_field beam_polarity beam_particle magneticField_Type ID_magneticField MBPL_magneticField MBPS_magneticField eta z theta Pix_StatusWord SCT_StatusWord TRT_StatusWord LAr_StatusWord Tile_StatusWord TileEB_StatusWord MDT_StatusWord TGC_StatusWord RPC_StatusWord CSC_StatusWord BEE_StatusWord Pix_xBeamPosition SCT_xBeamPosition TRT_xBeamPosition TRT_yBeamPosition TRT_zBeamPosition LArTile_xBeamPosition Muon_xBeamPosition MuonBee_xBeamPosition
default jobDefinition fields = name status

# CTB simulation, digitization and reconstruction
# NOTICE: semi-colon will be replaces with comma after parsing the fields

dataset field names = identifier,                                      name,                         runNumber,        transformationName, transformationVersion, projectName,       physicsWorkingGroup, physicsShort,      detectorLayout,    status,                                                                      principalSite,      softwareRelease,   physicsPackage,                      externalPackages,  outputFormat,         percentageValidatedFiles, percentageFailedFiles, totalFiles,   totalDataSize, averageEventSize, totalEvents,  averageCPUTime, totalCPUTime, requestedBy,       comment,           created,  lastModified, beamEnergy, mag_field,         beam_polarity,    beamParticle,                                                                                 magneticField_Type,            ID_magneticField, MBPL_magneticField, MBPS_magneticField, eta,        z,          theta,      Pix_StatusWord,       SCT_StatusWord,       TRT_StatusWord,       LAr_StatusWord,       Tile_StatusWord,      TileEB_StatusWord,    MDT_StatusWord,       TGC_StatusWord,       RPC_StatusWord,       CSC_StatusWord,       BEE_StatusWord,       Pix_xBeamPosition, SCT_xBeamPosition, TRT_xBeamPosition, TRT_yBeamPosition, TRT_zBeamPosition, LArTile_xBeamPosition, Muon_xBeamPosition, MuonBee_xBeamPosition, dataType,                                                                             inputDataset,      inputDB,           outputLocation
dataset field types = INT(16) DEFAULT NULL AUTO_INCREMENT PRIMARY KEY, VARCHAR(255) NOT NULL UNIQUE, INT(16) NOT NULL, VARCHAR(255) NULL,  VARCHAR(255) NULL,     VARCHAR(255) NULL, VARCHAR(255) NULL,   VARCHAR(255) NULL, VARCHAR(255) NULL, ENUM('Requested'; 'Approved'; 'Running'; 'Finished'; 'Validated'; 'Failed'), VARCHAR(255) NULL,  VARCHAR(255) NULL, ENUM('GEANT3'; 'GEANT4'; 'ATLFAST'), VARCHAR(255) NULL, ENUM('pool'; 'root'), FLOAT NULL,               FLOAT NULL,            INT(20) NULL, FLOAT NULL,    FLOAT NULL,       INT(20) NULL, FLOAT NULL,     INT(20) NULL, VARCHAR(255) NULL, VARCHAR(255) NULL, DATETIME, DATETIME,     FLOAT NULL, VARCHAR(255) NULL, TINYINT(16) NULL, ENUM('no beam'; 'photon'; 'electron'; 'muon'; 'pion'; 'proton'; 'gamma'; 'other'; 'unknown'), ENUM('constant'; 'field map'), FLOAT NULL,       FLOAT NULL,         FLOAT NULL,         FLOAT NULL, FLOAT NULL, FLOAT NULL, ENUM('-1'; '0'; '1'), ENUM('-1'; '0'; '1'), ENUM('-1'; '0'; '1'), ENUM('-1'; '0'; '1'), ENUM('-1'; '0'; '1'), ENUM('-1'; '0'; '1'), ENUM('-1'; '0'; '1'), ENUM('-1'; '0'; '1'), ENUM('-1'; '0'; '1'), ENUM('-1'; '0'; '1'), ENUM('-1'; '0'; '1'), FLOAT NULL,        FLOAT NULL,        FLOAT NULL,        FLOAT NULL,        FLOAT NULL,        FLOAT NULL,            FLOAT NULL,         FLOAT NULL,            ENUM('EVGEN'; 'ESD'; 'AOD'; 'BYTESTREAM'; 'TAG'; 'HITS'; 'RDO'; 'DIGITS'; 'DATASET'), VARCHAR(255) NULL, VARCHAR(255) NULL, VARCHAR(255) NULL

jobDefinition field names = identifier, datasetName, name, GUID, number, eventMin, eventMax, nEvents, outputFileSize, CPU, status, userInfo, inputFileNames, transPars, outFileMapping, md5sum, stdoutDest, stderrDest, productionSite, hostMachine, storageType, created, lastModified, jobID, outTmp, errTmp, validationResult, computingSystem
jobDefinition field types = INT(16) DEFAULT NULL AUTO_INCREMENT PRIMARY KEY, VARCHAR(255), VARCHAR(255), VARCHAR(255), INT(16) NULL, INT(16) NULL, INT(16) NULL, INT(16) NULL, INT(16) NULL, INT(16) NULL, ENUM('Defined'; 'Submitted'; 'Validated'; 'Failed'; 'Undecided'; 'Aborted') NULL, VARCHAR(255), VARCHAR(255), VARCHAR(255), VARCHAR(255), VARCHAR(255), VARCHAR(255), VARCHAR(255), VARCHAR(55), VARCHAR(55), ENUM('HPSS'; 'CASTOR'; 'DISK'; 'TAPE'; 'SRM'; 'GRIDFTP') NULL, DATETIME, DATETIME, VARCHAR(255) NULL, VARCHAR(255) NULL, VARCHAR(255) NULL, TEXT NULL, VARCHAR(255) NULL

transformation field names = identifier, name, version, runtimeEnvironmentName, arguments, outputFiles, script, comment, created, lastModified, code
transformation field types = INT(16) DEFAULT NULL AUTO_INCREMENT PRIMARY KEY, VARCHAR(255), VARCHAR(55), VARCHAR(255), VARCHAR(255), VARCHAR(255), VARCHAR(255), VARCHAR(255), DATETIME, DATETIME, VARCHAR(255)

runtimeEnvironment field names = identifier, name, computingSystem, certificate, url, initLines, created, lastModified
runtimeEnvironment field types = INT(16) DEFAULT NULL AUTO_INCREMENT PRIMARY KEY, VARCHAR(255), VARCHAR(255), TEXT, VARCHAR(255), TEXT, DATETIME, DATETIME

[AMI@Grenoble]
class = net.hep.atlas.Database.Bookkeeping.GridPilot.dbplugins.ami.AMIDatabase
database = jdbc:mysql://atlasbkk1.in2p3.fr:3306/Atlas_Bookkeeping_01_00_00
#database = jdbc:mysql://pcitapi34.cern.ch:3306/Atlas_Bookkeeping_01_00_00
level = motherDatabase
site = CERN
project = dc1
step =  simulation
user = dc1
password = 

parameters = project level site  database step user password

transDB = Atlas_Recipes
default dataset fields = dataset.logicalDatasetName dataset.identifier
default jobDefinition fields = jobDefinition.LFN jobDefinition.jobDefinitionStatus

[ProdDB@CERN]
dbName = ProdDB@CERN
class = gridpilot.dbplugins.proddb.ProdDBDatabase
user = atlas_prodsys_dev # atlas_prodsys_dev atlas_prodsys
password = # prodsys
database = oradev.cern.ch:10521:D # oradev:10521:D pdbatlas:1521:atlassg
driver = oracle.jdbc.driver.OracleDriver
dbPrefix = # atlas_prodsys. # atlas_prodsys_dev atlas_prodsys

parameters = dbName driver database user password dbPrefix

dataset name = taskName
jobDefinition name = jobName
dataset identifier = taskID
jobDefinition identifier = jobDefID
transformation identifier = jobTransID
default dataset fields = taskName status # * # 
hidden dataset fields = creationTime modificationTime actualPars taskTransFK
default jobDefinition fields = jobName controlState currentState inputHint maxAttempt priority events jobDefinitionID
hidden jobDefinition fields = maxAttempt controlState events jobDefinitionID

[Computing systems]
systems = NG # FORK GPSS LSF@CERN

[FORK]
# Run jobs on the local computer, either directly or via QEMU

## sub-Section for GridPilot
host = localhost
user =
password =
class = gridpilot.csplugins.fork.ForkComputingSystem
working directory = ~/GridPilot
max jobs by update = 40

## sub-Section for this plug-in
shell = /bin/bash
# Directory with runtime setup scripts
runtime directory = /tmp/runtime
# Where to write the runtime records
runtime database = HSQLDB
# Certificate used by submitters to encrypt their
# proxy certificate+key to the GridPilot picking up
# the job. Only needed to pick up jobs.
# NOTICE: the certificate should NOT include a key!
public certificate = # C:\Documents and Settings\Frederik Orellana\.globus\usercert.pem
# Remote DB to announce runtime environments and
# from where to pick up jobs. 
# Only needed to pick up jobs.
remote database = MySQL@Geneva

[GPSS]
# Submit jobs to a GridPilot database somewhere,
# where they will be picked up by other GridPilots

## sub-Section for GridPilot
host = grid01.unige.ch
user = root
password =
class = gridpilot.csplugins.gridpilot.GridPilotComputingSystem
working directory = ~/GridPilot
max jobs by update = 40

## sub-Section for this plug-in
shell = /bin/bash
runtime directory = /tmp/runtime
# Where to write the jobDefinitions.
remote database = MySQL@Geneva

[LSF@CERN]
## sub-Section for GridPilot
host = lxplus.cern.ch
user = fjob
password = 
class = gridpilot.csplugins.lsf.LSFComputingSystem
working directory = ~/GridPilot
max jobs by update = 40

## sub-Section for this plug-in
packageID = LSF@CERN
# Directory with runtime setup scripts
runtime directory = /afs/cern.ch/bla/bla
# Where to write the runtime records
runtime database = HSQLDB
# TODO: drop all these
shell = /usr/bin/env zsh
submission command = bsub -q 1nh
#submission command = bsub  -R type==LINUX6 -q prod400 -R "cpuf>1.5&&maxmem>500"
check command = bjobs
copy command = rfcp
remove command = rfrm
mkdir command = rfmkdir
kill command = bkill

[NG]
## sub-section for GridPilot
class = gridpilot.csplugins.ng.NGComputingSystem
max jobs by update = 10
working directory = GridPilot

## sub-Section for this plug-in
# Where to write the runtime records
runtime database = HSQLDB
use information system = yes
clusters = grid00.unige.ch # grid01.unige.ch lheppc10.unibe.ch hypatia.uio.no hagrid.it.uu.se benedict.grid.aau.dk nordugrid.unibe.ch nordugrid-lcg.projects.cscs.ch
# required CPU time in minutes
cpu time = 1800
# number of seconds before timeout of proxy when proxy will be renewed
timeleft limit = 86400
shell = /bin/sh

